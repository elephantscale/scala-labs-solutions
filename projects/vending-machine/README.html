<p><link rel='stylesheet' href='../assets/css/main.css'/></p>
<p><a href="../../README.html">&lt;&lt; back to main index</a></p>
<hr />
<h1 id="lab-5-implement-a-vending-machine-class-in-scala">Lab 5 : Implement A Vending Machine Class In Scala</h1>
<h3 id="overview">Overview</h3>
<p>Implement a full fledged Scala class</p>
<h3 id="depends-on">Depends On</h3>
<p>None</p>
<h3 id="run-time">Run time</h3>
<p>20 mins</p>
<h3 id="solution">Solution</h3>
<p>/es-training/spark/spark-solutions/01-scala/vending-machine-solution</p>
<h2 id="recommended-setup-in-order-of-preference">Recommended Setup (In order of preference)</h2>
<ul>
<li>If you are using an IDE (like IntelliJ) please open the project as an SBT project.</li>
<li>If you are using a UI editor like ‘Sublime’ open the ‘project root directory’ in editor (so you can navigate to all files easily).</li>
<li>If using command line, please open 2 terminals - 1 for editing files and other for running commands.</li>
</ul>
<h2 id="step-0-instructor">Step 0 : Instructor</h2>
<ul>
<li>Get the lab started on your screen.</li>
<li>Show how to complete TODO-1 &amp; 2 (upto STEP 5) on screen.</li>
<li>Then let the class complete rest of the TODO items.</li>
</ul>
<h2 id="step-1-project-directory">Step 1 : Project Directory</h2>
<p>Project directory is : <code>~/spark-labs/01-scala/vending-machine</code></p>
<p>Here is the project hierarchy:</p>
<p><img src="../assets/images/1.5b.png" style="border: 5px solid grey ; max-width:100%;" /></p>
<h2 id="step-2-open-project-in-intellij">Step 2 : Open Project in IntelliJ</h2>
<ul>
<li>File -&gt; Open</li>
<li>Navigate to : <code>~/spark-labs/01-scala/vending-machine</code> directory</li>
<li>Select <code>build.sbt</code> file</li>
<li>Make sure <code>Use Auto Import</code> is checked</li>
</ul>
<p><strong>See screen shots below</strong></p>
<p><img src="../assets/images/1.5c.png" style="border: 5px solid grey ; max-width:100%;" /> <img src="../assets/images/1.5d.png" style="border: 5px solid grey ; max-width:100%;" /> <img src="../assets/images/1.5e.png" style="border: 5px solid grey ; max-width:100%;" /></p>
<p>Final project should look like this:</p>
<p><img src="../assets/images/1.5f.png" style="border: 5px solid grey ; max-width:100%;" /></p>
<h2 id="step-3-inspect-vendingmachine-trait">Step 3 : Inspect ‘VendingMachine’ trait</h2>
<ul>
<li>Inspect the file <code>src/main/scala/x/VendingMachine.scala</code>.<br />
</li>
<li>This file defines the <code>trait</code> for a vending machine.<br />
</li>
<li>Notice how <code>ReturnCode</code> is defined.</li>
</ul>
<h2 id="step-4-vending-machine-test-driver">Step 4 : Vending Machine Test Driver</h2>
<ul>
<li>Inspect the file <code>src/main/scala/x/QuickTest.scala</code><br />
</li>
<li>Run this file by ‘Right Click -&gt; Run’</li>
<li>Your output may look like this</li>
</ul>
<pre class="console"><code>    Stocking &#39;coke&#39;, price = $1, qty = 10
        coke stock : 0
    Stocking &#39;m&amp;m&#39;, price = $2, qty = 20
        m&amp;m stock : 0
    Stocking &#39;oreo&#39;, price = $3, qty = 20
        oreo stock : 0</code></pre>
<p>As you can see, the implementation needs work.</p>
<h2 id="step-5-vending-machine-implementation">Step 5 : Vending Machine Implementation</h2>
<ul>
<li>Inspect the file <code>src/main/scala/x/MyVendingMachine.scala</code></li>
<li>We are going to fix <code>TODO</code> items in this file</li>
<li>Fix TODOs one function at a time</li>
<li>And run the QuickTest driver to verify that the code is working properly</li>
</ul>
<p>Here is how we fix TODO-1 and TODO-2</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scala"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>    <span class="kw">override</span> <span class="kw">def</span> <span class="fu">addStockItem</span>(item: String, price: Int, qty: Int): Int = {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>        <span class="kw">if</span> (store.<span class="fu">contains</span>(item)) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>          <span class="co">// adding an item with a new price automatically re-prices existing stock</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>          <span class="kw">val</span> newStock = <span class="fu">store</span>(item).<span class="fu">add</span>(price, qty)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>          <span class="co">// TODO-1 : put new stock in &#39;store&#39;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>          store.<span class="fu">put</span>(item, newStock)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>          newStock.<span class="fu">getQty</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>        } <span class="kw">else</span> {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>           store.<span class="fu">put</span>(item, <span class="kw">new</span> <span class="fu">Stock</span>(item, price, qty))</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>           <span class="co">// TODO-2 : return qty</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>           qty <span class="co">// fix this</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>    }</span></code></pre></div>
<h2 id="lab-ends">Lab Ends</h2>
<h2 id="optional-reference-for-using-sbt-tool">Optional Reference for Using SBT tool</h2>
<p>Here is how you can build the project with SBT.</p>
<h3 id="terminals">2 Terminals</h3>
<p>Please open 2 terminals - 1 for editing files and other for running commands.</p>
<p><img src="../assets/images/1.5a.png" style="border: 5px solid grey ; max-width:100%;" /></p>
<h3 id="project-root-directory">Project root directory</h3>
<p>Make sure you are in the project top level directory.</p>
<pre><code>    $   cd   ~/scala-labs/05-classes

    # see the project structure
    $   find .  | grep -v target</code></pre>
<h3 id="sbt">SBT</h3>
<p>Using one terminal, launch SBT from project root directory.</p>
<pre><code>    $   cd   ~/scala-labs/05-classes

    $   sbt
</code></pre>
<h3 id="running-the-program-in-sbt">Running the program in SBT</h3>
<p>SBT Commands * compile : will compile the program * run : compile and run the program</p>
<p>Let’s try this test driver. On your SBT terminal type</p>
<pre><code>    sbt&gt;
          run</code></pre>
<p>You will see following output from our test driver class.</p>
<pre class="console"><code>    &gt; run
    [info] compiling 1 scala source to /users/tim/elephantscale/spark-labs/01-scala/vending-machine/target/scala-2.11/classes...
    [info] Running x.QuickTest
    Stocking &#39;coke&#39;, price = $1, qty = 10
        coke stock : 0
    Stocking &#39;m&amp;m&#39;, price = $2, qty = 20
        m&amp;m stock : 0
    Stocking &#39;oreo&#39;, price = $3, qty = 20
        oreo stock : 0
    stock qty for coke 0
    price for oreo 0
    depositing $2
    trying to buy oreo @ $3 : Success
    trying to buy coke @ $1 : Success
    balance : 0
    [success] Total time: 2 s, completed May 16, 2016 4:00:55 PM
</code></pre>
<h3 id="once-you-edit-a-file-and-save-it-you-can-run-from-sbt-as-follows">Once you edit a file and save it, you can run from SBT as follows</h3>
<pre><code>    sbt&gt; 
            compile
            run</code></pre>
<h2 id="sbt-tips">SBT Tips</h2>
<h3 id="sbt-shell">SBT Shell</h3>
<p>You can issue sbt commands from shell as follows</p>
<pre><code>    $   sbt  clean compile run</code></pre>
<p>For iterative development, sbt shell is much faster !</p>
<pre><code>    $   sbt
    &gt; clean
    &gt; compile run
    &gt; run</code></pre>
<h3 id="specifying-a-main-class-to-run">Specifying A Main Class To Run</h3>
<pre><code>    $  sbt  &quot;run-main x.Foo&quot;</code></pre>
<pre><code>    # in sbt shell
    &gt;   runMain  x.foo</code></pre>
